<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>芙蓉社区</title>
    <link rel="stylesheet" href="component/pear/css/pear.css"/>
    <link rel="stylesheet" href="admin/css/other/login.css"/>
</head>
<!-- 代 码 结 构 -->
<body background="admin/images/background2.svg" style="background-size: cover;">
<form class="layui-form" action="javascript:void(0);">
    <div class="layui-form-item">
        <img class="logo" src="admin/images/logo.png"/>
        <div class="title"> 芙蓉社区</div>
        <div class="desc">
            芙蓉社区管理系统
        </div>
    </div>
    <div class="layui-form-item">
        <input id="username" placeholder="用户名 :  " hover class="layui-input" name="username"/>
    </div>
    <div class="layui-form-item">
        <input placeholder="密码 : " hover class="code layui-input " name="password"/>
        <!-- <button id="pbutton" type="button" class="layui-btn layui-btn-xs">发送短信</button> -->
    </div>
    <div class="layui-form-item">
        <button class="pear-btn pear-btn-success login" lay-submit lay-filter="login">
            登 入
        </button>
    </div>
</form>
<!-- 资 源 引 入 -->
<script src="component/layui/layui.js"></script>
<script src="component/pear/pear.js"></script>
<script>
    layui.use(['form', 'element', 'jquery', 'button', 'popup', 'layer'], function () {
        const form = layui.form;
        // const element = layui.element;
        // const button = layui.button;
        // const popup = layui.popup;
        const layer = layui.layer;
        const $ = layui.jquery;

        // $("#pbutton").click(function () {
        //
        //     let username = $("#username").val();
        //
        //     console.info(username)
        //
        //     $.ajax({
        //         url: 'http://localhost:8080/community/admin/sendSms',
        //         type: "get",
        //         data: {
        //             username: username
        //         },
        //         success: function (result) {
        //             if (result.code === 0) {
        //
        //                 layer.msg("发送成功!", {icon: 1, time: 1000});
        //             } else {
        //                 layer.msg(result.msg, {icon: 2, time: 1000});
        //             }
        //         }
        //     })
        //
        // });

        // 登 录 提 交
        form.on('submit(login)', function (data) {
            const loader = layer.load(1);
            $.ajax({
                url: '/api/auth/login',
                type: "post",
                data: JSON.stringify(data.field),
                contentType: 'application/json;charset=utf8',
                success: function (response) {
                    //存储登录信息到到localStorage
                    const waiting4 = 500;
                    layer.msg(response.message, {icon: 6, time: waiting4});
                    localStorage.setItem("token", response.result);
                    setTimeout(() => {
                        location.href = "index.html"
                    }, waiting4);
                },
                error: function (result) {
                    layer.msg(result.responseJSON.message, {icon: 2, time: 1000});
                },
                complete: function (/**result**/) {
                    layer.close(loader);
                }
            });

            // button.load({
            // 	elem: '.login',
            // 	time: 1500,
            // 	done: function() {
            // 		popup.success("登录成功", function() {
            // 			location.href = "index.html"
            // 		});
            // 	}
            // })
            return false;
        });
    })
</script>
</body>
</html>
